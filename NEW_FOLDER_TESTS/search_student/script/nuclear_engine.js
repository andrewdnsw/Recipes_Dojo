var anim,child,$alert,queries_ok,dbpedia_queries,max_images_is_grab,max_images_no_grab;win_opened=[],voice={},queries=[],options={},img_opened_is_grab=[],img_opened_no_grab=[],had=[];var fire_grab=function(){$("#dijit_layout_StackController_3_s_grab").click()};function spot_generator(e,t,o){o=(o=o||e.length-1)<0?0:o;var n,i=t.length,a=i-o;a=a<0?0:a;do{n=Math.floor(Math.random()*(1e3*e.length-1)/1e3);for(var s=!1,r=!0,c=a;c<i;c++)n==t[c]&&(r=!1);r&&(s=!0)}while(!s);return t.push(n),"http://"+e[n]+".appspot.com"}function bounceOut(e){var t=7.5625,o=2.75;return e<1/o?t*Math.pow(e,2):e<2/o?(e-=1.5/o,t*Math.pow(e,2)+.75):e<2.5/o?(e-=2.25/o,t*Math.pow(e,2)+.9375):(e-=2.625/o,t*Math.pow(e,2)+.984375)}function browserMessage(e){var t=getPageSize()[3];($alert=$("#alert")).css("z-index","999").html(e),$alert.append($("<div>").addClass("alert_close_btn")),anim({node:"alert",easing:bounceOut,properties:{top:{start:0,end:t-160},opacity:{start:.1,end:1}},duration:1e3}).stop().play(),$alert.unbind("mouseup").bind("mouseup",alert_hide)}function alert_hide(){$alert.css("z-index","-1")}function writer(e){$(".queryText").val(queries[e].sparql)}function callBack_dbpedia(e){dbpedia_invite=e,$("#dbpedia_invite").append($(e)),$(".query").remove();var o=$("<select>").addClass("align_right").addClass("special_field").addClass("selector_field"),n=setInterval(function(){if(queries_ok){clearInterval(n),queries=dbpedia_queries.querySets.dbpedia;for(var e=0;e<queries.length;e++){var t=$("<option>").text(queries[e].name).val(e);o.append(t)}$(".ui-combobox").empty().append(o),o.unbind("mouseup").bind("mouseup",function(){writer(o.val())})}},10)}function getPageSize(){var e,t,o,n;return t=window.innerHeight&&window.scrollMaxY?(e=document.body.scrollWidth,window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,document.body.scrollHeight):document.documentElement&&document.documentElement.scrollHeight>document.documentElement.offsetHeight?(e=document.documentElement.scrollWidth,document.documentElement.scrollHeight):(e=document.body.offsetWidth,document.body.offsetHeight),self.innerHeight?(o=self.innerWidth,n=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(o=document.documentElement.clientWidth,n=document.documentElement.clientHeight):document.body&&(o=document.body.clientWidth,n=document.body.clientHeight),[e<o?o:e,t<n?n:t,o,n]}!function(){var very_scroll,lodlive_was,context_was,dbpedia_was,wdqs_was,$wdqs_div,annotation_was,dbpedia_semantic,annotation_semantic,lodlive_semantic,wdqs_semantic,space=" ",the_dot=".",the_comma=",",the_s="s_",the_sharp="#",the_defis=" - ",ff,make_semantic,close_btn,lodlive_window_x,lodlive_window_y,chromeFirst,panes_stack,dbpedia_invite,dbpedia_window,annotation_queries,wd_select_val,$wdqs,$s_wdqs,$lodlive,$s_lodlive;max_images_is_grab=5,max_images_no_grab=8;var $anSelect,$anStartBtn,$anStopBtn,$anResult,$an,br="<br>",area,loader_gray='<img class = "loaderGray" src="'+software_holder+'lodlive/img/ajax-loader-gray.gif" style="margin-left:6px;margin-top:2px"/><br>',doAn_arr=[],urlToAnnotate,anStopBtnPushed,dojo_select_lodlive_dialog,dojo_select_wdqs_dialog,dojo_search_engines_dialog,dojo_select_context_dialog,dojo_select_show_dialog,dojo_select_sort_dialog,dojo_select_pareto_dialog,dojo_select_levenstain_dialog,site_url,search_engines_dialog,search_engines_dialog_tt,context_dialog,context_dialog_tt,context_dialog_tt_id,show_dialog,show_dialog_tt,sort_dialog,sort_dialog_tt,pareto_dialog,pareto_dialog_tt,levenstain_dialog,levenstain_dialog_tt,lodlive_dialog,wdqs_dialog,temp,dummy,selected,user_access_level,$img_x,$img_y,$img_z,$img_lod,$img_wdqs,_grand_user,choice_menu_make,choice_menu_place,trees={},dojo_dialog_constructor,sort_attr,sort_attr_tempo,sort_attr_last,frame,iframe,invisible_div,the_web="web",the_search,the_logo,the_grab="grab",wel_com,rating,preloader_handle,search_selected=the_web,lbl_1,lbl_2,lbl_clone,request,request_clone,header_wrap,make_fine,coming_search,req_text=space,from_meta_keywords="",from_meta_categories="";the_context={},context_obj={},tokens_obj={},req_text_obj={},meta_keywords_obj={},meta_categories_obj={};var search_tabs={web:{},images:{},video:{},blogs:{},news:{},books:{},patent:{},local:{},progr:{},network:{},micro:{},common:{},lib:{},project:{}};aspects={},d_aspects=[];var max_aspects,select_context_tt_was=!1;panes=[{id:"semantic",tab:"grab",z:4},{id:"global",tab:"web",z:3},{id:"docs",tab:"progr",z:2},{id:"libs",tab:"lib",z:1},{id:"frame",tab:"frame",z:0}],search_divs=["global","docs","libs"];var max_z=panes.length,links,links_size;tokens=[];var search_site,last_tab="#s_grab",form_ok,voice_ok,context_dialog_ok,ya_child_ok,form,navigation,ya_child,image_animator_x,image_animator_y,image_animator_z,image_animator_lod,image_animator_wdqs,regex_url_pattern=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,regex_url=/\(?(?:(http|https|ftp):\/\/)?(?:((?:[^\W\s]|\.|-|[:]{1})+)@{1})?((?:www.)?(?:[^\W\s]|\.|-)+[\.][^\W\s]{2,4}|localhost(?=\/)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::(\d*))?([\/]?[^\s\?]*[\/]{1})*(?:\/?([^\s\n\?\[\]\{\}\#]*(?:(?=\.)){1}|[^\s\n\?\[\]\{\}\.\#]*)?([\.]{1}[^\s\?\#]*)?)?(?:\?{1}([^\s\n\#\[\]]*))?([\#][^\s\n]*)?\)?/,reg_host=/(.+:\/\/)?([^\/]+)(\/.*)*/i,reg_html=/<[^>]*>|\n|\f|[\;\?\,\(\)\"\!\*\%\&\«\»]/gi,reg_punct=/[^\w+|\u0400-\u04FF]+/gi,reg_union=/только|также|обычно|или|для|как|что|когда|при(?=\s)|все(?=\s)|and(?=\s)|for(?=\s)/gi,reg_quot=/quot/gi,reg_quot_replace='"',reg_cookies=/\[|\]|"|'/gi,reg_the_dot=/\./gi,reg_space=/ /gi,reg_many_space=/ {1,}/gi,reg_special=/\"/gi,the_special="%#%#%#%#%",x_pane,z,dojo_prefix="#dijit_layout_StackController_",snippets_makers={},engine_makers={},yandexuid,yandexuid_last;yandex_appspot_opened=[],mailru_appspot_opened=[],yahoo_appspot_opened=[],yandexuid_arr=["4775440541","6539080821","9918290441","2239940301","7545070271"],$alert=$("#alert");var img_size=142,img_radius=10,vid_size=142,vid_radius=71,scroll_api,clone,tree_scroll_api,minus_h,iframe_handler,interval_handler;function adjust_scroll(){make_fine.cssText="position:absolute;top:10px;bottom:0px;left:12px;right:12px;font-size:13px;",interval_handler&&clearInterval(interval_handler),interval_handler=setInterval(do_adjust,200)}function fast_scroll_work(){200<scroll_api.getContentPositionY()?$("#back-top").fadeIn():$("#back-top").fadeOut()}very_scroll=function(e){$(function(){e=(e=e||last_tab).substr(0,1)==the_sharp?e:the_sharp+e,scroll_api=$(e).jScrollPane().data("jsp")}),adjust_scroll(),last_tab=e};var do_adjust=function(){$(function(){$(window).unbind("scroll"),scroll_api&&scroll_api.reinitialise(),fast_scroll_work(),$(window).bind("scroll",fast_scroll_work)})},random_digit=function(){return Math.floor(9999*Math.random()/1e3)};function get_yandexuid_pair(){z=yandexuid_arr[Math.floor(4999*Math.random()/1e3)];for(var e=0;e<8;e++)z+=random_digit();return"yandexuid="+z}function make_req_text(e,t,o){var n=(t?o+space+e:e).replace(reg_special,the_special);return(search_site?"site:"+search_site+space+n:n).replace(reg_space,"+")}function tab_done(e){console.log("Всего сделано запросов - "+e+" - "+search_tabs[e].calls)}function machine_done(e,t,o){console.log(t+" - "+e+" - Всего сделано запросов: "+o)}function ajax_fail(e,t,o,n){console.log(t+" - $.ajax error: "+o+". jqXHR.readyState: "+n)}function empty_serp(e,t,o,n){console.log(t+" - запрос "+o+the_defis+e+" - пустой serp. "+n)}function normal_serp(e,t,o){console.log(t+" - запрос "+o+the_defis+e+" - нормальный serp.")}function machine_denied(e,t){console.log(t+" - поисковая машина временно недоступна.")}function machine_start(e,t,o){console.log(t+" - начат новый поиск "+e+the_defis+o)}function machine_stop(e,t){console.log(t+" - работа принудительно закончена.")}function make_search(e){for(var t=!e,o=the_web,n=0;n<panes.length;n++)if("global"==panes[n].id){o=panes[n].tab;break}if(search_type=e?e.substr(2):o,x_pane=dojo.byId(search_type),panes_stack("global",e),t||!search_tabs[search_type].status){if(t)for(var e in search_tabs)search_tabs[e].snippets=0,search_tabs[e].status=null,search_tabs[e].engines?stop_search_engines(e):search_tabs[e].engines={};else search_tabs[search_type].snippets=0;for(var i in search_tabs[search_type].calls=0,search_tabs[search_type].had=[],(search_tabs[search_type].x_pane=x_pane).innerHTML=voice.preloader,show_coming_search(search_type,x_pane),search_tabs[search_type].status="started",options.search_engines)0<Number(options.search_engines[i])&&(search_tabs[search_type].engines[i]=new engine_makers[i+"_task_constructor"](search_type,snippets_makers["make_"+search_type+"_snippets"],i))}else"started"==search_tabs[search_type].status?show_coming_search(search_type,x_pane):hide_coming_search(search_type,x_pane)}function all_done(e){var t=!0;for(var o in search_tabs[e].engines)search_tabs[e].engines[o].active&&(t=!1);return t}function fine_search(e,t){all_done(e)&&($("div:not(.search_forbidden)",$(t)).is(":empty")||$("div.search_forbidden",$(t)).remove(),options.sort.d&&web_snippets_dominance(t,e),t.lastChild.innerHTML="<br><br>",hide_coming_search(e),search_tabs[e].status="fine",tab_done(e))}function forbidden_search(e,t){all_done(e)&&($("div.search_forbidden",$(t)).remove(),coming_search.style.zIndex=-1,search_tabs[e].coming_search=!1,t&&$(".preloader",$(t)).remove(),$(t).append($("<div/>").addClass("search_forbidden").html(voice.forbidden)),$(t).append($("<br/>")),search_tabs[e].status="forbidden",tab_done(e))}function empty_search(e,t){all_done(e)&&(hide_coming_search(e,t),0==search_tabs[e].snippets&&$(t).empty().append($("<div/>").addClass("search_empty").html(voice.not_found)),search_tabs[e].status="empty",tab_done(e))}function stop_search_engines(e,t){for(var o in search_tabs[e].engines)search_tabs[e].engines[o].active=!1;hide_coming_search(e),t&&$(".preloader",$(t)).html("<br>")}function show_coming_search(e,t){coming_search.style.zIndex=1,search_tabs[e].coming_search=!0,$(coming_search).unbind("mouseup").bind("mouseup",function(){stop_search_engines(e,t)})}function hide_coming_search(e,t){coming_search.style.zIndex=-1,search_tabs[e].coming_search=!1,t&&$(".preloader",$(t)).html("<br>")}function alpha(e,t,o){return Number(e.getAttribute(o))>Number(t.getAttribute(o))?1:Number(e.getAttribute(o))<Number(t.getAttribute(o))?0:null}function d_y_x(e,t){for(var o,n=0,i=0;i<d_aspects.length;i++)(o=alpha(e,t,d_aspects[i]))&&(n+=o);return n}function web_snippets_dominance(e,t){var o,n,i,a,s,r,c,_=sort_attr_last.substr(0,1),l="r"==_?"p":"r",d=$("<div/>").html("<br>").get(0);tempo_arr=[],$(the_dot+t+"_snippet",$(e)).each(function(e,t){tempo_arr[e]=t});for(var p=0;p<tempo_arr.length;p++){for(var u=s=0;u<tempo_arr.length;u++)s<(r=d_y_x(tempo_arr[u],tempo_arr[p]))&&(s=r);if(i=tempo_arr[p],a=$(i),c=max_aspects-s,a.attr("d",c),"images"==t||"video"==t){var h=$("a",a);h.attr("title",h.attr("title")+voice.domin+c)}else $(".rel_per",a)[0].insertAdjacentHTML("beforeEnd",voice.dominance+c);for(n=pSib(o=d.lastChild);n&&n.hasAttribute("d")&&Number(n.getAttribute("d"))<Number(i.getAttribute("d"));)n=pSib(o=n);d.insertBefore(i,o)}for($(e).empty().append($("<br/>")),i=d.firstChild;i;){for(n=pSib(o=e.lastChild);n&&Number(i.getAttribute("d"))==Number(n.getAttribute("d"))&&Number(i.getAttribute(_))==Number(n.getAttribute(_))&&Number(i.getAttribute(l))>Number(n.getAttribute(l));)n=pSib(o=n);e.insertBefore(i,o),i=d.firstChild}}function put_snippet(e,t){if(sort_attr&&"n"!=sort_attr){$(e).attr("r",aspects.relevance).attr("p",aspects.pertinence).attr("r_m",aspects.relevance_meta).attr("p_m",aspects.pertinence_meta).attr("m_k",aspects.meta_keywords).attr("m_c",aspects.meta_categories);var o=t.lastChild,n=pSib(o);for(sort_attr_tempo="d"==sort_attr?sort_attr_last:sort_attr;n&&n.hasAttribute(sort_attr_tempo)&&Number(n.getAttribute(sort_attr_tempo))<Number(e.getAttribute(sort_attr_tempo));)n=pSib(o=n);if("p"==sort_attr||"p_m"==sort_attr)for(;n&&n.hasAttribute(sort_attr_tempo)&&Number(n.getAttribute(sort_attr_tempo))==Number(e.getAttribute(sort_attr_tempo))&&Number(n.getAttribute("r"))<Number(e.getAttribute("r"));)n=pSib(o=n);else if("r"==sort_attr||"r_m"==sort_attr)for(;n&&n.hasAttribute(sort_attr_tempo)&&Number(n.getAttribute(sort_attr_tempo))==Number(e.getAttribute(sort_attr_tempo))&&Number(n.getAttribute("p"))<Number(e.getAttribute("p"));)n=pSib(o=n);t.insertBefore(e,o)}else t.insertBefore(e,t.lastChild)}function unic_snippet(e,t){var o=!1;for(k=0;k<t.length;k++)e==t[k]&&(o=!0);return!!o||(t.push(e),!1)}function measure(e,t){var o,n=0;for(var i in e)for(var a in t)o=levenshtein(i,a),isNaN(o)||Number(o)>=Number(options.levenstain.equal)||(n+=(options.levenstain.equal-o)*e[i]*t[a]);return n}function levenshtein(e,t){var o,n,i,a,s=(o=e.split("")).length,r=(t=t.split("")).length;if(!s&&!r)return Math.max(s,r);for(var c=[],_=s+options.levenstain.insert;_;c[--_]=[_]);for(_=r+options.levenstain.remove;c[0][--_]=_;);for(_=-1,i=o.length;++_<i;)for(n=-1,a=t.length;++n<a;)c[1+(_*=1)][1+(n*=1)]=Math.min(c[_][n+1]+options.levenstain.remove,c[_+1][n]+options.levenstain.insert,c[_][n]+(o[_]!=t[n]?options.levenstain.replace:0));return c[s][r]}function make_tokens_obj(e,t){for(var o in e)delete e[o];for(var n=t.toLowerCase().replace(reg_punct," ").replace(reg_union," ").replace(/[\r\n\f]/g," ").split(space),i=0;i<n.length;i++){var a=n[i];a.length>options.levenstain.max&&(a=a.substr(0,options.levenstain.max)),a.length<options.levenstain.min||(e[a]?e[a]++:e[a]=1)}}function calc_aspects(e){aspects={},make_tokens_obj(tokens_obj,e),aspects.relevance=measure(tokens_obj,req_text_obj),aspects.pertinence=measure(tokens_obj,context_obj),aspects.meta_keywords=measure(tokens_obj,meta_keywords_obj),aspects.meta_categories=measure(tokens_obj,meta_categories_obj);var t=aspects.meta_keywords+aspects.meta_categories;aspects.relevance_meta=aspects.relevance+t,aspects.pertinence_meta=aspects.pertinence+t}function pane_comparator(e,t){return e.z<t.z?1:-1}function view_pane(e){dojo.query(".fine").forEach(function(e){e.style.zIndex=-1,dojo.query(".centerPanel > div",e).forEach(function(e){e.style.zIndex=-1})}),view_tab(e),"semantic"==e.id?close_btn.style.zIndex=-1:(close_btn.style.zIndex=1,"frame"==e.id?close_btn.setAttribute("title",voice.close_doc):close_btn.setAttribute("title",voice.close_search))}function view_tab(e){$(the_s+e.tab).css("opacity","0").css("zIndex","0"),setTimeout(function(){anim({node:e.tab,properties:{opacity:{start:0,end:1}},duration:200}).play(),dojo.byId(e.id).style.zIndex=0},200);var t=dojo.query(the_sharp+the_s+e.tab+" > .skrepka_fixed")[0];if(t&&"visible"==t.style.visibility)very_scroll(e.tab);else{var o="frame"==e.id?e.id:the_s+e.tab;very_scroll(o)}-1<e.tab.indexOf(the_grab)?(get_img($img_z,image_animator_z,400,e.tab),request.style.display="none",the_search.style.display="none",the_logo.style.display="inline-block"):(request.style.display="inline-block",the_search.style.display="inline-block",the_logo.style.display="none")}function start(){ff=-1<navigator.userAgent.toLowerCase().indexOf("firefox");var login=function(){location=voice.login},registry=function(){location=voice.registry},logout=function(){location=voice.logout};request=dojo.byId("request");var $request=$(request);$request.val("").mouseover(function(){$request.unbind("focus"),$request.focus()}),request_clone=dojo.byId("request_clone");var $request_clone=$(request_clone);$request_clone.val("").mouseover(function(){$request_clone.unbind("focus"),$request_clone.focus()}),coming_search=dojo.byId("coming_search"),the_search=dojo.byId("search"),the_logo=dojo.byId("logo"),temp=dojo.byId("invisible_ff"),$(close_btn).unbind("mouseup").bind("mouseup",function(){panes_stack(),coming_search.style.zIndex=-1}),_grand_user=!1,chromeFirst=!0,child=null,dojo.query(".demoLayout").forEach(function(e){var t=e.id;dojo.query(".centerPanel > div",e).forEach(function(e){"docs"==t?$(dojo_prefix+"0_"+e.id).parent().parent().unbind("click").bind("click",function(){panes_stack(t,e.id),do_search(!0)}):"libs"==t?$(dojo_prefix+"1_"+e.id).parent().parent().unbind("click").bind("click",function(){panes_stack(t,e.id),do_search(!0)}):"global"==t?$(dojo_prefix+"2_"+e.id).parent().parent().unbind("click").bind("click",function(){make_search(e.id)}):"semantic"==t&&$(dojo_prefix+"3_"+e.id).parent().parent().unbind("click").bind("click",function(){make_semantic(e.id)})})}),dojo.connect(window,"onresize",null,function(){wdqs_semantic&&$wdqs.height($s_wdqs.height()-3),lodlive_semantic&&$lodlive.height($s_lodlive.height()-3),very_scroll()}),set_access(),choice_menu_place=dojo.byId("choice"),require(["dijit/Menu","dijit/MenuItem","dijit/form/DropDownButton","dijit/form/TextBox","dojo/domReady!"],function(l,d,p){var e=new l({style:"display: none;"}),t=new d({label:voice.help_semantic_0,onMouseUp:help_semantic_0});e.addChild(t);var o=new d({label:voice.help_semantic_1,onMouseUp:help_semantic_1});e.addChild(o);var n=new d({label:voice.help_semantic_2,onMouseUp:help_semantic_2});e.addChild(n);var i=new d({label:voice.help_semantic_3,onMouseUp:help_semantic_3});e.addChild(i);var a=new d({label:voice.help_semantic_4,onMouseUp:help_semantic_4});e.addChild(a);var s=new d({label:voice.help_semantic_5,onMouseUp:help_semantic_5});e.addChild(s);var r=new d({label:voice.help_semantic_6,onMouseUp:help_semantic_6});e.addChild(r);var c=new d({label:voice.help_semantic_7,onMouseUp:help_semantic_7});e.addChild(c);var _=new d({label:voice.help_semantic_8,onMouseUp:help_semantic_8});e.addChild(_);var u=new d({label:voice.help_semantic_9,onMouseUp:help_semantic_9});e.addChild(u);var h=new d({label:voice.help_context,onMouseUp:help_context});e.addChild(h),new p({label:voice.begining,dropDown:e}).placeAt(dojo.byId("begin")),(choice_menu_make=function(e,t,o){choice=new l({style:"display: none;"}),choice_lodlive=new d({label:voice.select_lodlive_option,onMouseUp:set_lodlive_opt}),choice.addChild(choice_lodlive),choice_wdqs=new d({label:voice.select_wdqs_option,onMouseUp:set_wdqs_opt}),choice.addChild(choice_wdqs);var n=new d({label:voice.select_show_short,onMouseUp:select_show});choice.addChild(n);var i=new d({label:voice.select_search_engines_short,onMouseUp:select_search_engines});choice.addChild(i);var a=new d({label:voice.select_context_short,onMouseUp:select_context});choice.addChild(a);var s=new d({label:voice.select_sort_short,onMouseUp:select_sort});choice.addChild(s);var r=new d({label:voice.select_pareto_short,onMouseUp:select_pareto});choice.addChild(r);var c=new d({label:voice.select_levenstain_short,onMouseUp:select_levenstain});choice.addChild(c);var _=new p({label:e,dropDown:choice});$(choice_menu_place).empty(),_.placeAt(choice_menu_place),lbl_1=choice_menu_place.querySelector(".dijitButtonText")})(voice.choice_tuning,voice.choice_context,show_context_search);var m=new l({style:"display: none;"}),v=new d({label:voice.web,onMouseUp:function(){search_selected=the_web,do_search()}});m.addChild(v);var g=new d({label:voice.docs,onMouseUp:function(){search_selected="docs",do_search()}});m.addChild(g);var f=new d({label:voice.libs,onMouseUp:function(){search_selected="libs",do_search()}});m.addChild(f);var b=new d({label:voice.leninka,onMouseUp:function(){search_selected="leninka",do_search()}});m.addChild(b);var y=new d({label:voice.wiki_en,onMouseUp:function(){search_selected="wiki_en",do_search()}});m.addChild(y);var x=new d({label:voice.wiki_ru,onMouseUp:function(){search_selected="wiki_ru",do_search()}});m.addChild(x);var w=new d({label:voice.academy,onMouseUp:function(){search_selected="academy",do_search()}});m.addChild(w);var j=new d({label:voice.scopus,onMouseUp:function(){search_selected="scopus",do_search()}});m.addChild(j);var k=new d({label:voice.WoS,onMouseUp:function(){search_selected="WoS",do_search()}});m.addChild(k);var q=new d({label:voice.MIT,onMouseUp:function(){search_selected="MIT",do_search()}});m.addChild(q);var T=new p({label:voice.s,dropDown:m}),C=new p({label:voice.s,dropDown:m});T.placeAt(the_search),C.placeAt(dojo.byId("search_menu_button_clone")),lbl_2=dojo.byId("dijit_form_DropDownButton_2_label"),lbl_clone=dojo.byId("dijit_form_DropDownButton_3_label")});var optoins_cookie=get_cookie_pair(voice.options_name);if(optoins_cookie){var the_cookie=optoins_cookie.split("=")[1];options=JSON.parse(the_cookie)}else options=eval("("+voice.options+")");for(var name in options.lodlive&&options.lodlive&&options.wdqs&&options.search_engines&&options.context&&options.sort&&options.show&&options.levenstain&&options.pareto||(options=eval("("+voice.options+")")),options.sort)options.sort[name]&&(sort_attr_last="r",sort_attr=name);for(var aspect in d_aspects=[],options.pareto)options.pareto[aspect]&&d_aspects.push(aspect);function help_semantic_0(){show_help(voice.help_semantic_0_url,"$help_semantic_0")}function help_semantic_1(){show_help(voice.help_semantic_1_url,"$help_semantic_1")}function help_semantic_2(){show_help(voice.help_semantic_2_url,"$help_semantic_2")}function help_semantic_3(){show_help(voice.help_semantic_3_url,"$help_semantic_3")}function help_semantic_4(){show_help(voice.help_semantic_4_url,"$help_semantic_4")}function help_semantic_5(){show_help(voice.help_semantic_5_url,"$help_semantic_5")}function help_semantic_6(){show_help(voice.help_semantic_6_url,"$help_semantic_6")}function help_semantic_7(){show_help(voice.help_semantic_7_url,"$help_semantic_7")}function help_semantic_8(){show_help(voice.help_semantic_8_url,"$help_semantic_8")}function help_semantic_9(){show_help(voice.help_semantic_9_url,"$help_semantic_9")}function help_context(){show_help(voice.help_context_url,"$help_context_doc$")}function search_about(){show_help(voice.search_about_doc,"$search_about_doc$")}function show_help(e,t){for(n=0;n<win_opened.length;n++)t==win_opened[n].name&&(win_opened[n].win.close(),win_opened.splice(n,1));show_doc(e,t)}max_aspects=d_aspects.length,lodlive_dialog=dojo.query("div#_lodlive_dialog",dummy)[0],wdqs_dialog=dojo.query("div#_wdqs_dialog",dummy)[0],search_engines_dialog=dojo.query("div#_search_engines_dialog",dummy)[0],context_dialog=dojo.query("div#_context_dialog",dummy)[0],sort_dialog=dojo.query("div#_sort_dialog",dummy)[0],show_dialog=dojo.query("div#_show_dialog",dummy)[0],pareto_dialog=dojo.query("div#_pareto_dialog",dummy)[0],levenstain_dialog=dojo.query("div#_levenstain_dialog",dummy)[0],context_dialog_tt_id="select_context_tt",select_search_engines(!1),select_context(!1),select_sort(!1),select_show(!1),select_pareto(!1),select_levenstain(!1),grab_start(the_grab),make_semantic("s_lodlive"),panes_stack("semantic"),dojo.connect(request,"onchange",null,function(){request_clone.value=request.value}),dojo.connect(request_clone,"onchange",null,function(){request.value=request_clone.value}),dojo.connect(request,"onkeydown",null,function(e){e=e||window.event,request_clone.value=request.value,13==e.keyCode&&do_search()}),dojo.connect(request_clone,"onkeydown",null,function(e){e=e||window.event,request.value=request_clone.value,13==e.keyCode&&do_search()}),window.onbeforeunload=function(){for(n=0;n<win_opened.length;n++)win_opened[n].win.close();document.cookie=voice.options_name+"="+JSON.stringify(options)+";expires="+new Date(2050,1).toUTCString()+";"},$("#back-top").hide(),$("#back-top a").css("opacity","1"),$("#back-top a").unbind("mouseup").bind("mouseup",function(){return scroll_api.positionDragY(0,!0),!1})}function show_context_search(){context_was?(panes_stack("docs"==search_selected?"docs":"libs"==search_selected?"libs":"global"),choice_menu_make(voice.choice_tuning,voice.choice_semantic,to_semantic)):do_search()}function do_search(e){for(var t in options.sort)options.sort[t]&&(sort_attr_last="d"==sort_attr||"n"==sort_attr?sort_attr_last:sort_attr,sort_attr=t);context_was=!0,request.value&&""!=request.value||(req_text=request.value=request_clone.value=voice.ksst),lbl_2.innerHTML=lbl_clone.innerHTML=voice[search_selected];var o=request.value;req_text=request.value=o.replace(reg_union,space).replace(reg_many_space,space),make_tokens_obj(req_text_obj,req_text),choice_menu_make(voice.choice_tuning,voice.choice_semantic,to_semantic),$(".dijitTooltipDialogPopup").css("display","none"),"docs"==search_selected||"libs"==search_selected?(e||panes_stack(search_selected),dojo.byId(panes[0].tab).innerHTML=voice.preloader,coming_search.style.zIndex=-1,setTimeout(function(){fetch_tree(panes[0].tab,trees[panes[0].tab].treeStore,req_text)},300)):(search_site=null,"wiki_en"==search_selected?search_site="en.wikipedia.org":"wiki_ru"==search_selected?search_site="ru.wikipedia.org":"academy"==search_selected?search_site="scholar.google.com":"scopus"==search_selected?search_site="scimagojr.com/journalrank.php":"WoS"==search_selected?search_site="ip-science.thomsonreuters.com/cgi-bin/jrnlst/jlresults.cgi":"MIT"==search_selected?search_site="ocw.mit.edu":"leninka"==search_selected&&(search_site="cyberleninka.ru"),make_search())}function lodlive_scroll_save(){var e=dojo.query("#lodlive > iframe")[0];if(e){var t=e.contentWindow;lodlive_window_x=t.pageXOffset,lodlive_window_y=t.pageYOffset}}function to_semantic(){panes_stack("semantic"),coming_search.style.zIndex=-1,choice_menu_make(voice.choice_tuning,voice.choice_context,show_context_search)}function dbpedia_start(e){}function wdqs_start(e){}function wdqs_load(){}function annotation_start(e){}function annotation_load(){}function doAnSelect(){var e=annotation_queries[$anSelect.val()].url;e.length&&(area.value+=e+"\n",$anSelect[0].selectedIndex=0,alert_hide())}function doAnStartBtn(){$anStartBtn.css("display","none"),$anStopBtn.css("display","block"),anStopBtnPushed=!1;var e=area.value.split("\n");urlToAnnotate=[];for(var t=0;t<e.length;t++){var o=$.trim(e[t]);regex_url.test(o)&&urlToAnnotate.push({url:o,done:!1})}if(area.value="",!urlToAnnotate.length)return browserMessage(voice.noUrlToAnnotate),void doAnStopBtn();for(t=0;t<urlToAnnotate.length;t++)area.value+=urlToAnnotate[t].url+"\n";if(area.selectionStart){var n=area.value.length;area.focus(),area.setSelectionRange(n,n),area.focus()}$anResult.empty().html('<label style="font-size:1.15em;">'+voice.an_result+"</label>"+br);for(t=0;t<urlToAnnotate.length;t++){o=urlToAnnotate[t].url;var i=reg_host.exec(o)[2],a=$('<div class="an_link" url="'+o+'" hostname="'+i+'"><img src="http://favicon.yandex.net/favicon/'+i+'" style="border:0px;float:left;margin-right:5px;" alt="" url="'+o+'" hostname="'+i+'">'+o+"</div><br>");$anResult.append(a),$anResult.append($('<div id="anres_'+t+'">'+loader_gray+"</div>")),a.bind("mouseup",on_search_up),new doAn(t)}var s=setInterval(function(){for(var e=!0,t=0;t<urlToAnnotate.length;t++)urlToAnnotate[t].done||(e=!1);e&&(clearInterval(s),doAnStopBtn())},10)}function doAnStopBtn(){$anStartBtn.css("display","block"),$anStopBtn.css("display","none"),anStopBtnPushed=!0}function doAn(e){}function set_access(){if("true"!=user_authorized)user_name="Гость",welcom(voice.authorized_no),user_access_level=0;else if("true"==user_authorized&&"true"!=user_has_rank)welcom(voice.authorized_ok),user_access_level=1;else if("true"==user_authorized&&"true"==user_has_rank){welcom(voice.authorized_ok),user_access_level=1;for(var e=0;e<voice.grand_users.length;e++)user_rank_name==voice.grand_users[e]&&(_grand_user=!0,user_access_level=2)}else user_name="Гость",welcom(voice.authorized_no),user_access_level=0}function get_access(e,t){var o=0;if(e.hasAttribute(t,"access")){var n=e.getValue(t,"access",null);o="0"==n||"common"==n||"public"==n?0:"1"==n||"student"==n?1:"2"==n||"professor"==n?2:3}return o}function welcom(e,t){}function show_doc(e,t,o){var n=getPageSize(),i=(6*n[2]/8).toFixed(0),a=(10*n[3]/12).toFixed(0),s=(n[2]/8).toFixed(0),r=(n[3]/8).toFixed(0);if(child=window.open(e,t,"left="+s+",top="+r+",width="+i+",height="+a+",location=no,directories=no,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no,alwaysRaised=yes"),o)var c=setInterval(function(){child&&(clearInterval(c),child.document.body&&(child.document.body.innerHTML=""),child.document.writeln(o))},10);childIsOK(t)}function load_doc(e,t){if(!e.hasAttribute(t,"children")){var o=e.hasAttribute(t,"owner"),i=e.getValue(t,"url",null),a=""==i||null==i||null==i?"http://vt.obninsk.ru/search_student/stock/no_doc.html":i,s=get_access(e,t);if(s<=user_access_level||"admin"==user_name||o&&user_name==e.getValue(t,"owner",null));else if("true"!=user_authorized)a=stock_holder+"no_access.html";else if(2==s)a=stock_holder+"no_student.html";else if(3==s){-1==e.getValue(t,"access",null).indexOf(user_name)&&(a=stock_holder+"no_level.html")}else alert(voice.err);for(n=0;n<win_opened.length;n++)a==win_opened[n].name&&(win_opened[n].win.close(),win_opened.splice(n,1));options.show.popup?show_doc(a,a):options.show.tabs?(child=window.open(a,"_blank"),childIsOK(a)):activate_frame(a)}}function tab(){options.show.popup=!1,options.show.tabs=!0,options.show.frame=!1}function toframe(){options.show.popup=!1,options.show.tabs=!1,options.show.frame=!0}function popup(){options.show.popup=!0,options.show.tabs=!1,options.show.frame=!1}function ajax_get(e,t){dojo.xhrGet({url:e,load:function(e){t.innerHTML=e},error:function(e,t){console.log(voice.ajaxError+t.xhr.status)}})}function test_browser(){return!(-1<navigator.vendor.toLowerCase().indexOf("apple")||-1<navigator.userAgent.toLowerCase().indexOf("trident"))||(ajax_get(stock_holder+"bad_semantic.html",document.getElementById("banner")),!1)}function ajax_start(t){dojo.xhrGet({url:t,load:function(e){0<=t.indexOf("form_navigation")?(navigation.innerHTML=e,form.appendChild(dojo.query("form#_footer_form_to_post",navigation)[0]),form_ok=!0):0<=t.indexOf("tree_voice")?(voice=JSON.parse(e.replace(/[\r\n\t]/g,"")),voice_ok=!0):0<=t.indexOf("context_dialogs")&&(dummy.innerHTML=e,context_dialog_ok=!0)},error:function(e,t){browserMessage(voice.ajaxError+t.xhr.status)}})}function get_img(e,t,o,n){var i,a,s,r=!1;if(o=o||500,e.css({opacity:"0","margin-top":"-999",display:"none"}),e.unbind("load").bind("load",function(){t.stop().play(o),setTimeout(function(){e.css("display","block")},o)}),e.css("cursor","pointer"),-1<n.indexOf("dbpedia")?(e.unbind("mouseup").bind("mouseup",dbpedia_load),e.attr("title",voice.mes_dbpedia_go)):-1<n.indexOf("wdqs")?(e.unbind("mouseup").bind("mouseup",wdqs_load),e.attr("title",voice.mes_wdqs_go)):-1<n.indexOf("annotation")?(e.unbind("mouseup").bind("mouseup",annotation_load),e.attr("title",voice.mes_annotation_go)):-1<n.indexOf(the_grab)&&(e.unbind("mouseup").bind("mouseup",function(){do_search(null)}),e.attr("title",voice.mes_grab_go),r=!0),r){do{i=Math.floor(Math.random()*(1e3*max_images_is_grab-1)/1e3),s=!(a=!1);for(var c=img_opened_is_grab.length;0<c&&c>img_opened_is_grab.length-3;c--)if(i==img_opened_is_grab[c-1]){s=!1;break}s&&(a=!0)}while(!a);img_opened_is_grab.push(i)}else{do{i=Math.floor(max_images_is_grab+Math.random()*(1e3*max_images_no_grab-1)/1e3),s=!(a=!1);for(c=img_opened_no_grab.length;0<c&&c>img_opened_no_grab.length-2;c--)if(i==img_opened_no_grab[c-1]){s=!1;break}s&&(a=!0)}while(!a);img_opened_no_grab.push(i)}e.attr("src","http://vt.obninsk.ru/docs/xs/ksst_search_"+i+".png")}function activate_frame(n,e){panes_stack("frame"),frame.innerHTML=voice.preloader;var t=e||reg_host.exec(n)[2];if(-1<t.indexOf("google"))s();else{var i=document.createElement("iframe");i.className="iframe",frame.innerHTML="",frame.appendChild(i);var a=i.contentDocument||i.contentWindow.document;if(0<=t.indexOf("youtu"))return n="https://youtu.be/"+n.slice(-11),void(i.src=software_holder+"php/iframe_page.php?url="+n);dojo.xhrGet({url:software_holder+"php/iframe_page_x_frame_opt.php?url="+n,load:function(e){if(-1<e.indexOf("true")){if(console.log("Сайт не разрешает открывать себя в iframe"),ff)return void s();var o;$.get(voice.grab+"?url="+n).done(function(e){if(""==e)s();else{var t=(o=e).indexOf("<head>");0<t&&(o=o.substr(0,t+6)+"<script type='text/javascript'>"+voice.console_script+"<\/script>"+o.substr(t+6));try{a.open("text/html","replace"),a.write(o),a.close(),$(i).load(function(){""==a.body?s():console.log("Сайт подгружен в iframe через pythongrab: "+n)})}catch(e){console.log("Ошибка "+e.name+": "+e.message+"\n"+e.stack)}}}).fail(function(e,t){browserMessage(voice.ajaxError+t),s()})}else i.src=n,$(i).load(function(){""==a.body&&s()})},error:function(e,t){browserMessage(voice.ajaxError+t.xhr.status)}})}function s(){dojo.xhrGet({url:stock_holder+"no_iframe.html",load:function(e){console.log("q = "+e),frame.innerHTML=e,$(".no_frame_close_me",$(frame)).unbind("mouseup").bind("mouseup",function(){panes_stack()})},error:function(e,t){browserMessage(voice.ajaxError+t.xhr.status)}})}}function ru_access(e){return"common"==e||""==e?voice.common:"student"==e?voice.student:"professor"==e?voice.professor:voice.project}function on_mouse_up(e){if(2!=(e=e||window.event).button&&3!=e.button){target=e.target||e.srcElement;var t=target.getAttribute("has_owner"),o=target.getAttribute("url"),i=target.getAttribute("doc_level"),a=target.getAttribute("hostname");if(i<=user_access_level||"admin"==user_name||t&&user_name==target.getAttribute("owner"));else if("true"!=user_authorized)o=stock_holder+"no_access.html";else if(2==i)o=stock_holder+"no_student.html";else if(3==i){-1==target.getAttribute("access").indexOf(user_name)&&(o=stock_holder+"no_level.html")}else alert(voice.err);for(n=0;n<win_opened.length;n++)o==win_opened[n].name&&(win_opened[n].win.close(),win_opened.splice(n,1));options.show.popup?show_doc(o,o):options.show.tabs?(child=window.open(o,"_blank"),childIsOK(o)):activate_frame(o,a)}}function on_search_up(e){var t=e||window.event;if(2!=t.button&&3!=t.button){var o=t.target||t.srcElement;if(o){var i=o.getAttribute("url"),a=o.getAttribute("hostname");for(o.firstChild&&o.firstChild.getAttribute&&(i=i||o.firstChild.getAttribute("url"),a=a||o.firstChild.getAttribute("hostname")),n=0;n<win_opened.length;n++)i==win_opened[n].name&&(win_opened[n].win.close(),win_opened.splice(n,1));options.show.popup?show_doc(i,i):options.show.tabs?(child=window.open(i,"_blank"),childIsOK(i)):activate_frame(i,a)}}}function fetch_tree(e,a,t){coming_search.style.zIndex=1;var i=dojo.byId(e);had=[],links=0;var s,r,c=[],o=t.replace(new RegExp("\\.+|,+|:+"),"");for(o=o.replace(new RegExp(" и | или | для | and | or | for "),space),tokens=o.split(space),n=0;n<tokens.length;n++)c.push({name:"*"+tokens[n]+"*"}),c.push({keywords:"*"+tokens[n]+"*"});!function t(o){if(o>=c.length)return coming_search.style.zIndex=-1,void(0<links?("d"==sort_attr&&web_snippets_dominance(i,the_web),$(i.lastChild).removeClass("search_empty").html("<br><br>")):($mess=$("<div/>").addClass("search_empty").html(voice.not_found),$(i).empty().append($mess)));setTimeout(function(){a.fetch({query:c[o],queryOptions:{deep:!0,ignoreCase:!0},onComplete:function(e){r={responseData:{results:[]}},dojo.forEach(e,function(e){var t=a.getValue(e,"url",null);if(!a.hasAttribute(e,"children")&&""!=t){var o=a.getValue(e,"name",null),n=a.getValue(e,"keywords",null),i=a.getValue(e,"access",null)||"common";(s={unescapedUrl:t,titleNoFormatting:o}).content=voice.keywords+(n||voice.unknown)+the_dot+space+ru_access(i),$.inArray(s,r.responseData.results)<0&&r.responseData.results.push(s),links++}}),snippets_makers.make_web_snippets(r,i,the_web,had),t(o+1)}})},10)}(0)}function backOut(e){e-=1;return Math.pow(e,2)*(2.70158*e+1.70158)+1}function pSib(e){for(;e=e.previousSibling;)if(1==e.nodeType)return e;return null}function pNext(e){for(;e=e.nextSibling;)if(1==e.nodeType)return e;return null}function set_lodlive_opt(){}function set_wdqs_opt(){}function select_search_engines(visible){for(var aspect in dojo_search_engines_dialog=dojo_search_engines_dialog||new dojo_dialog_constructor({title:voice.select_search_engines,content:search_engines_dialog}),options.search_engines)dojo.query(the_sharp+aspect+"_number",search_engines_dialog)[0].value=options.search_engines[aspect];function select_search_engines_done(e){e=e||event;var target=e.target||e.srcElement;if("select_search_engines_done"==target.id)for(var aspect in options.search_engines)options.search_engines[aspect]=dojo.query(the_sharp+aspect+"_number",search_engines_dialog)[0].value;else if("refresh_search_options"==target.id){var z=options.lodlive;options=eval("("+voice.options+")"),options.lodlive=z}dojo_search_engines_dialog.hide(),alert_hide()}visible?dojo_search_engines_dialog.show():dojo.query("button",dojo_search_engines_dialog.content).forEach(function(e){e.onmouseup=select_search_engines_done})}function select_context(e,t){if(dojo_select_context_dialog=dojo_select_context_dialog||new dojo_dialog_constructor({title:voice.select_context,content:context_dialog}),select_context_start(!0),e){t||dojo_select_context_dialog.show(),(site_url=dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"handle_site_upload_text")[0])&&(dojo.query("input#handle_site_upload_text",dojo_select_context_dialog.content)[0].value=site_url.value);var o=dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"handle_file_upload")[0];o&&(dojo.query("input#handle_file_upload",dojo_select_context_dialog.content)[0].files=o.files)}else $("span.dijitDialogCloseIcon").bind("mouseup",alert_hide),dojo.query("button#select_context_close",dojo_select_context_dialog.content)[0].onmouseup=n,dojo.query("button#select_context_done",dojo_select_context_dialog.content)[0].onmouseup=function(){select_context_done(),n()},dojo.query("input#handle_site_upload",dojo_select_context_dialog.content)[0].onmouseup=function(){handle_site_upload(!0,this)},dojo.query("input#handle_site_upload_text",dojo_select_context_dialog.content)[0].onkeydown=function(e){13==(e=e||event).keyCode&&handle_site_upload(!0,this)},dojo.query("input#handle_file_upload",dojo_select_context_dialog.content)[0].onchange=function(){handle_file_upload(this.files,this)};function n(){dojo_select_context_dialog.hide(),alert_hide()}}function select_context_start(e){var t,o,n,i;for(var a in options.context)(n=e?dojo.query(the_sharp+a+"_cbx",dojo_select_context_dialog.content)[0]:dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+a+"_cbx")[0]).checked=options.context[a],i=$(n),(t=$(n.parentNode)).find("img").length||t.append(voice.coming),eye_on(o=t.find("img")),cbx_change(i),"file"!=a&&"web"!=a||o.attr("src",voice.eye),n.checked?(o.css("display","inline"),load_context(a,o[0])):(o.css("display","none"),the_context[a]=null)}function eye_on(e){e.unbind().mouseup(function(e){var t=pSib((e=e||window.event).target||e.srcElement).id,o=t.substr(0,t.indexOf("_"));alert_hide(),the_context[o]?show_doc(null,o,the_context[o]):browserMessage(voice.no_context)})}function cbx_change(e){e.unbind().change(function(e){var t=(e=e||window.event).target||e.srcElement,o=t.id,n=o.substr(0,o.indexOf("_"));options.context[n]=t.checked;var i=$(t.parentNode).find("img");t.checked?(load_context(n,i[0]),i.css("display","inline")):i.css("display","none")})}function select_context_done(){for(var e in context_obj={},options.context)if(options.context[e]&&the_context[e])for(var t=the_context[e].toLowerCase().replace(reg_punct," ").replace(reg_union," ").replace(/[\r\n\f]/g," ").split(space),o=0;o<t.length;o++){var n=t[o];n.length>options.levenstain.max&&(n=n.substr(0,options.levenstain.max)),n.length<options.levenstain.min||(context_obj[n]?context_obj[n]++:context_obj[n]=1)}alert_hide()}function load_context(t,o){if("file"!=t&&"web"!=t){var n=voice["nuclear_"+t];try{$.get(voice.grab+"?url="+n+";cleaning=true").done(function(e){""==e?(o.style.display="none",alert(voice.bad_url+". URL: "+n)):(the_context[t]=e,o.src="./images/_show.png")}).fail(function(e,t){o.style.display="none"})}catch(e){}}}function handle_file_upload(e,i){var a=pSib(i);a.style.display="inline-block";var t=new FormData;t.append("context_file_upload",e[0]);$.ajax({url:software_holder+"php/context_file_upload.php",type:"POST",processData:!1,contentType:!1,cache:!1,data:t}).done(function(e){the_context.file=e,a.style.display="none";var t=pSib(i.parentNode),o=dojo.query("input",t)[0];o.checked=options.context.file=!0,cbx_change($(o));var n=dojo.query("img",t)[0];$(n).css("display","inline"),eye_on($(n)),"dijitTooltipContainer"==t.parentNode.parentNode.parentNode.className&&-1<navigator.userAgent.toLowerCase().indexOf("webkit")&&select_context(!0,!0)}).fail(function(e,t){browserMessage(voice.ajaxError+t),a.style.display="none"})}function handle_site_upload(e,i){var a;site_url=e?(a=dojo.query("img#select_context_site_upload",dojo_select_context_dialog.content)[0],dojo.query("input#handle_site_upload_text",dojo_select_context_dialog.content)[0]):(a=dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"select_context_site_upload")[0],dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"handle_site_upload_text")[0]),a.style.display="inline-block";$.get(voice.grab+"?url="+site_url.value+";cleaning=true").done(function(e){""==e?s(voice.bad_url):the_context.web=e,a.style.display="none";var t=pSib(i.parentNode),o=dojo.query("input",t)[0];o.checked=options.context.web=!0,cbx_change($(o));var n=dojo.query("img",t)[0];$(n).css("display","inline"),eye_on($(n))}).fail(function(e,t){browserMessage(voice.ajaxError+t),s(voice.bad_site),a.style.display="none"});function s(e){site_url.value=e,site_url.style.color="red",setTimeout(function(){site_url.style.color="black",site_url.value=""},2500)}}function select_sort(e){for(var t in dojo_select_sort_dialog=dojo_select_sort_dialog||new dojo_dialog_constructor({title:voice.select_sort,content:sort_dialog}),options.sort)dojo.query("#_sort_dialog "+the_sharp+t+"_radio")[0].checked=options.sort[t];function o(e){if("select_sort_done"==((e=e||event).target||e.srcElement).id)for(var t in options.sort)options.sort[t]=dojo.query("#_sort_dialog "+the_sharp+t+"_radio")[0].checked,console.log("select_sort_done: name = "+t+" value = "+options.sort[t]),options.sort[t]&&(sort_attr_last="d"==sort_attr||"n"==sort_attr?sort_attr_last:sort_attr,sort_attr=t);dojo_select_sort_dialog.hide(),alert_hide()}e?dojo_select_sort_dialog.show():dojo.query("button",dojo_select_sort_dialog.content).forEach(function(e){e.onmouseup=o})}function select_show(e){for(var t in dojo_select_show_dialog=dojo_select_show_dialog||new dojo_dialog_constructor({title:voice.select_show,content:show_dialog}),options.show)dojo.query("#_show_dialog "+the_sharp+t+"_radio")[0].checked=options.show[t];function o(e){if("select_show_done"==((e=e||event).target||e.srcElement).id)for(var t in options.show)options.show[t]=dojo.query("#_show_dialog "+the_sharp+t+"_radio")[0].checked;dojo_select_show_dialog.hide(),alert_hide()}e?dojo_select_show_dialog.show():dojo.query("button",dojo_select_show_dialog.content).forEach(function(e){e.onmouseup=o})}function select_pareto(e){for(var t in dojo_select_pareto_dialog=dojo_select_pareto_dialog||new dojo_dialog_constructor({title:voice.select_pareto,content:pareto_dialog}),options.pareto)dojo.query("#_pareto_dialog "+the_sharp+t+"_cbx")[0].checked=options.pareto[t];function o(e){if("select_pareto_done"==((e=e||event).target||e.srcElement).id){for(var t in d_aspects=[],options.pareto)options.pareto[t]=dojo.query("#_pareto_dialog "+the_sharp+t+"_cbx")[0].checked,options.pareto[t]&&d_aspects.push(t);max_aspects=d_aspects.length}dojo_select_pareto_dialog.hide(),alert_hide()}e?dojo_select_pareto_dialog.show():dojo.query("button",dojo_select_pareto_dialog.content).forEach(function(e){e.onmouseup=o})}function select_levenstain(e){for(var t in dojo_select_levenstain_dialog=dojo_select_levenstain_dialog||new dojo_dialog_constructor({title:voice.select_levenstain,content:levenstain_dialog}),options.levenstain)dojo.query("#_levenstain_dialog "+the_sharp+t+"_number")[0].value=options.levenstain[t];function o(e){if("select_levenstain_done"==((e=e||event).target||e.srcElement).id)for(var t in options.levenstain)options.levenstain[t]=dojo.query("#_levenstain_dialog "+the_sharp+t+"_number")[0].value;dojo_select_levenstain_dialog.hide(),alert_hide()}e?dojo_select_levenstain_dialog.show():dojo.query("button",dojo_select_levenstain_dialog.content).forEach(function(e){e.onmouseup=o})}function grab_start(type){$img_z=$("<img>"),$("#grab").append($("<div>").attr("align","center").append($img_z)),image_animator_z=new anim({node:$img_z.get(0),easing:backOut,properties:{marginTop:{start:960,end:30},opacity:{start:0,end:1}},duration:1200}),get_img($img_z,image_animator_z,400,type),require(["dijit/TooltipDialog","dojo/on"],function(TooltipDialog,on){require(["dijit/popup"],function(popup){var target,menu_item=dojo.byId("the_search_engines"),id="select_search_engines_tt",leave=!0;search_engines_dialog_tt=search_engines_dialog.cloneNode(!0);var select_search_engines_tt=new TooltipDialog({id:id,content:search_engines_dialog_tt,onMouseLeave:function(){leave&&(anim_out(id),setTimeout(function(){popup.close(select_search_engines_tt)},400))},onMouseUp:function(e){e=e||event,target=e.target||e.srcElement,"select_search_engines_done"==target.id?dojo.query("input",search_engines_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_"));options.search_engines[t]=e.value}):"refresh_search_options"==target.id&&(options=eval("("+voice.options+")")),"BUTTON"==target.tagName&&(leave=!1,anim_out(id),setTimeout(function(){popup.close(select_search_engines_tt),leave=!0},400))}});function on_menu_item(){dojo.query("input",search_engines_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_"));e.value=options.search_engines[t]}),popup.open({popup:select_search_engines_tt,around:menu_item,orient:["below","after"]}),anim_in(id)}on(menu_item,"mouseover",function(e){e=e||event,target=e.target||e.srcElement,setTimeout(function(){$(target).is(":hover")&&on_menu_item()},400)})}),require(["dijit/popup"],function(t){var o,n=dojo.byId("the_context");context_dialog_tt=context_dialog.cloneNode(!0);var i=new TooltipDialog({id:context_dialog_tt_id,content:context_dialog_tt,onMouseLeave:function(){},onMouseUp:function(e){e=e||event,"select_context_done"==(o=e.target||e.srcElement).id&&select_context_done(),"BUTTON"==o.tagName&&(anim_out(context_dialog_tt_id),setTimeout(function(){t.close(i)},400))}});on(n,"mouseover",function(e){e=e||event,o=e.target||e.srcElement,setTimeout(function(){$(o).is(":hover")&&function(){t.open({popup:i,around:n,orient:["below","after"]}),select_context_start(!1),anim_in(context_dialog_tt_id),site_url&&(dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"handle_site_upload_text")[0].value=site_url.value);var e=dojo.query("input#handle_file_upload",dojo_select_context_dialog.content)[0];e&&(dojo.query(the_sharp+context_dialog_tt_id+space+the_sharp+"handle_file_upload")[0].files=e.files);select_context_tt_was||(dojo.query(the_sharp+context_dialog_tt_id+space+"input#handle_site_upload")[0].onmouseup=function(){handle_site_upload(!1,this)},dojo.query(the_sharp+context_dialog_tt_id+space+"input#handle_site_upload_text")[0].onkeydown=function(e){13==(e=e||event).keyCode&&handle_site_upload(!1,this)},dojo.query(the_sharp+context_dialog_tt_id+space+"input#handle_file_upload")[0].onchange=function(){handle_file_upload(this.files,this)},select_context_tt_was=!0)}()},400)})}),require(["dijit/popup"],function(t){var o,n=dojo.byId("the_sort"),i="select_sort_tt",a=!0;sort_dialog_tt=sort_dialog.cloneNode(!0);var s=new TooltipDialog({id:i,content:sort_dialog_tt,onMouseLeave:function(){a&&(anim_out(i),setTimeout(function(){t.close(s)},400))},onMouseUp:function(e){e=e||event,"select_sort_done"==(o=e.target||e.srcElement).id&&dojo.query("input",sort_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_radio"));options.sort[t]=e.checked}),"BUTTON"==o.tagName&&(a=!1,anim_out(i),setTimeout(function(){t.close(s),a=!0},400))}});on(n,"mouseover",function(e){e=e||event,o=e.target||e.srcElement,setTimeout(function(){$(o).is(":hover")&&(dojo.query("input",sort_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_radio"));e.checked=options.sort[t]}),t.open({popup:s,around:n,orient:["below","before"]}),anim_in(i))},400)})}),require(["dijit/popup"],function(t){var o,n=dojo.byId("the_show"),i="select_show_tt",a=!0;show_dialog_tt=show_dialog.cloneNode(!0);var s=new TooltipDialog({id:i,content:show_dialog_tt,onMouseLeave:function(){a&&(anim_out(i),setTimeout(function(){t.close(s)},400))},onMouseUp:function(e){e=e||event,"select_show_done"==(o=e.target||e.srcElement).id&&dojo.query("input",show_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_radio"));options.show[t]=e.checked}),"BUTTON"==o.tagName&&(a=!1,anim_out(i),setTimeout(function(){t.close(s),a=!0},400))}});on(n,"mouseover",function(e){e=e||event,o=e.target||e.srcElement,setTimeout(function(){$(o).is(":hover")&&(dojo.query("input",show_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_radio"));e.checked=options.show[t]}),t.open({popup:s,around:n,orient:["below","after"]}),anim_in(i))},400)})}),require(["dijit/popup"],function(t){var o,n=dojo.byId("the_pareto"),i="select_pareto_tt",a=!0;pareto_dialog_tt=pareto_dialog.cloneNode(!0);var s=new TooltipDialog({id:i,content:pareto_dialog_tt,onMouseLeave:function(){a&&(anim_out(i),setTimeout(function(){t.close(s)},400))},onMouseUp:function(e){e=e||event,"select_pareto_done"==(o=e.target||e.srcElement).id&&dojo.query("input",pareto_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_cbx"));options.pareto[t]=e.checked}),"BUTTON"==o.tagName&&(a=!1,anim_out(i),setTimeout(function(){t.close(s),a=!0},400))}});on(n,"mouseover",function(e){e=e||event,o=e.target||e.srcElement,setTimeout(function(){$(o).is(":hover")&&(dojo.query("input",pareto_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_cbx"));e.checked=options.pareto[t]}),t.open({popup:s,around:n,orient:["below","after"]}),anim_in(i))},400)})}),require(["dijit/popup"],function(t){var o,n=dojo.byId("the_levenstain"),i="select_levenstain_tt",a=!0;levenstain_dialog_tt=levenstain_dialog.cloneNode(!0);var s=new TooltipDialog({id:i,content:levenstain_dialog_tt,onMouseLeave:function(){a&&(anim_out(i),setTimeout(function(){t.close(s)},400))},onMouseUp:function(e){e=e||event,"select_levenstain_done"==(o=e.target||e.srcElement).id&&dojo.query("input",levenstain_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_number"));options.levenstain[t]=e.value}),"BUTTON"==o.tagName&&(a=!1,anim_out(i),setTimeout(function(){t.close(s),a=!0},400))}});on(n,"mouseover",function(e){e=e||event,o=e.target||e.srcElement,setTimeout(function(){$(o).is(":hover")&&(dojo.query("input",levenstain_dialog_tt).forEach(function(e){var t=e.id.substring(0,e.id.indexOf("_number"));e.value=options.levenstain[t]}),t.open({popup:s,around:n,orient:["below","before"]}),anim_in(i))},400)})})})}function anim_in(e){anim({node:e,properties:{opacity:{start:0,end:1}},duration:400}).stop().play()}function anim_out(e){anim({node:e,properties:{opacity:{start:1,end:0}},duration:400}).stop().play()}function get_cookie_pair(e){for(var t=document.cookie.split(";"),o=0;o<t.length;o++){var n=t[o];if(-1<n.indexOf(e))return n.replace(space,"")}return null}engine_makers.Yahoo_task_constructor=function(r,c,_){var l,d,p=search_tabs[r].x_pane,u={},h=this;h.active=!0,h.the_counter=0,h.blogs=!1,h.shippets=0,u.search_engine_name=_,u.search_type=r;var e=voice.yahoo_ylt+voice.yahoo_ylu;if(r==the_web)u.search_engine_url=voice.yahoo_web_engine_url+e;else if("images"==r)u.search_engine_url=voice.yahoo_images_engine_url+e;else if("video"==r)u.search_engine_url=voice.yahoo_video_engine_url+e;else{if("blogs"!=r)return this.active=!1,void empty_search(r,p);u.search_engine_url=voice.yahoo_web_engine_url+e,h.blogs=!0}u.request_text=make_req_text(req_text,h.blogs,"блог");var m=document.cookie.replace(/;/gi,the_comma).replace(reg_space,"");m.indexOf("ymuid")<0&&(0<m.length&&(m+=the_comma),m+=voice.yahoo_ymuid),m.indexOf("sSN")<0&&(m+=the_comma+voice.yahoo_sSN),u.cookies=m,d=spot_generator(voice.appspot_arr,yahoo_appspot_opened,2),machine_start(r,_,d),function a(s){{if(!h.active)return machine_stop(r,_),void machine_done(r,_,h.the_counter);if(s>=Number(options.search_engines.Yahoo)||h.the_counter>=voice.mail_counter_max||0==l)return h.blogs?(u.request_text=make_req_text(req_text,h.blogs,"blog"),h.blogs=!1,void a(0)):(h.active=!1,machine_done(r,_,h.the_counter),void(0<h.shippets?fine_search(r,p):empty_search(r,p)))}u.serp_number=s;var o=$.ajax({type:"POST",url:d,data:JSON.stringify(u),dataType:"json",contentType:"application/json",cache:!1,crossDomain:!0});o.done(function(e){var t=e.reply_word,o=e.serp_number;if(search_tabs[r].calls++,h.the_counter++,"normal"==t){l=0;var n=e.response_data;normal_serp(r,_,o);var i=e.received_cookies.toString().replace(reg_cookies,"").replace(reg_space,"");(i=i.toString().replace(reg_cookies,"").replace(reg_space,"")).indexOf("ymuid")<0&&(0<i.length&&(i+=the_comma),i+=voice.yahoo_ymuid),i.indexOf("sSN")<0&&(i+=the_comma+voice.yahoo_sSN),u.cookies=i,l+=c(JSON.parse(n),p,r,search_tabs[r].had),h.shippets+=l,search_tabs[r].snippets+=l,a(s+1)}else if("denied"==t){if(h.the_counter>voice.mail_counter_max)return machine_denied(r,_),h.active=!1,console.log(voice.s_err_limit),machine_done(r,_,h.the_counter),void forbidden_search(r,p);d=spot_generator(voice.appspot_arr,yahoo_appspot_opened,2),empty_serp(r,_,o,d),u.cookies=m,a(s)}else{if("empty"==t)return h.blogs?(u.request_text=make_req_text(req_text,h.blogs,"blog"),h.blogs=!1,void a(0)):(h.active=!1,console.log(voice.s_err_serp),machine_done(r,_,h.the_counter),void empty_search(r,p));if("error"==t){if(console.log(_+the_defis+voice.server_err+e.exception),h.the_counter>voice.mail_counter_max)return machine_denied(r,_),h.active=!1,console.log(voice.s_err_limit),machine_done(r,_,h.the_counter),void forbidden_search(r,p);u.cookies=m,a(s)}}});o.fail(function(e,t){ajax_fail(r,_,t,o.readyState),h.active=!1,console.log(voice.s_err_post),machine_done(r,_,h.the_counter),forbidden_search(r,p)});setTimeout(function(){h.active&&o.readyState<4&&(h.active=!1,console.log(voice.s_err_long),machine_done(r,_,h.the_counter),forbidden_search(r,p))},7e3)}(0)},engine_makers.MailRu_task_constructor=function(g,f,b){var y,x,w=search_tabs[g].x_pane,j={};if(req_text=req_text.replace(reg_special,the_special),j.request_text=(search_site?"site:"+search_site+space+req_text:req_text).replace(reg_space,"+"),j.search_engine_name=b,(j.search_type=g)==the_web)j.search_engine_url=voice.mailru_web_engine_url;else if("images"==g)j.search_engine_url=voice.mailru_images_engine_url;else{if("video"!=g)return this.active=!1,void empty_search(g,w);j.search_engine_url=voice.mailru_video_engine_url}var k=this;k.active=!0,k.the_counter=0,k.shippets=0;var e=document.cookie.replace(/;/gi,",").replace(reg_space,"");e.indexOf("sid")<0&&(0<e.length&&(e+=the_comma),e+=voice.mailru_sid),e.indexOf("searchuid")<0&&(e+=the_comma+voice.mailru_searchuid),j.cookies=e,x=spot_generator(voice.appspot_arr,mailru_appspot_opened,2),machine_start(g,b,x),function m(v,e){if(e);else{if(!k.active)return machine_stop(g,b),void machine_done(g,b,k.the_counter);if(v>=Number(options.search_engines.MailRu)||k.the_counter>=Number(voice.mail_counter_max))return k.active=!1,machine_done(g,b,k.the_counter),void(0<k.shippets?fine_search(g,w):empty_search(g,w))}j.serp_number=v;var o=$.ajax({type:"POST",url:x,data:JSON.stringify(j),dataType:"json",contentType:"application/json",cache:!1,crossDomain:!0});o.done(function(n){search_tabs[g].calls++,k.the_counter++;var o,i,t,a,s,r=!1,e=n.reply_word,c=n.serp_number;if("normal"==e){var _=n.received_cookies;if((_=_.toString().replace(reg_cookies,"").replace(reg_space,"")).indexOf("sid")<0&&(0<_.length&&(_+=the_comma),_+=voice.mailru_sid),_.indexOf("sid")<0&&(_+=the_comma+voice.mailru_searchuid),j.cookies=_,ff)if("images"==g||"video"==g)s=window.open("",g,"left=9999,top=9999,width=50,height=50,location=no,directories=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no,alwaysRaised=no"),t=setInterval(function(){var e;s&&(clearInterval(t),s.document.open("text/html","replace"),s.document.write(n.serp),s.document.close(),$(s.document).ready(function(){a=setInterval(function(){(e=s.document.getElementById("mediaResponsesList"))&&0<e.innerHTML.length&&(clearInterval(a),temp.innerHTML=e.innerHTML,s.close(),r=!0,h(temp))},5)}))},10);else{if(g!=the_web)return k.active=!1,console.log(voice.s_err_serp),machine_done(g,b,k.the_counter),void empty_search(g,w);var l=n.serp.replace(/window/g,"document"),d=l.indexOf("<head>");0<d&&(l=l.substr(0,d+6)+"<script type='text/javascript'>"+voice.console_script+"<\/script>"+l.substr(d+6)),o=$("<iframe/>").appendTo("body").on("load",function(){$(this).contents().find("body").html("Я");var e=this,t=e.contentDocument||e.contentWindow.document;t.designMode="on",t.open("text/html","replace"),t.write(l),t.close(),i=setInterval(function(){temp.innerHTML="",temp.innerHTML=$(e).contents().find("body").find("#js-result").html(),(-1<temp.innerHTML.indexOf("js-result")||-1<temp.innerHTML.indexOf("mediaResponsesList"))&&(clearInterval(i),r=!0,h(temp),o.remove())},10)})}else{var p=document.createElement("iframe");invisible_div.appendChild(p);var u=p.contentDocument||p.contentWindow.document,l=n.serp?n.serp.replace(/window/g,"document").replace(new RegExp("/n","g"),""):"Пустой серп",d=l.indexOf("<head>");0<d&&(l=l.substr(0,d+6)+"<script type='text/javascript'>"+voice.console_script+"<\/script>"+l.substr(d+6)),u.open("text/html","replace");try{u.write(l)}catch(e){}u.close(),$(p).load(function(){r=!0,h(u),p.parentNode.removeChild(p)})}}else if("denied"==e);else{if("empty"==e)return k.active=!1,console.log(voice.s_err_serp),machine_done(g,b,k.the_counter),void empty_search(g,w);if("error"==e)return console.log(b+the_defis+voice.server_err+n.exception),k.active=!1,console.log(voice.s_err_exception),machine_done(g,b,k.the_counter),void forbidden_search(g,w)}function h(e){var s,r={responseData:{results:[]}};y=0;var t=dojo.query("#antirobot",e)[0],o=!1;if(e.innerHTML&&(o=-1<e.innerHTML.indexOf("antirobot")||-1<e.innerHTML.indexOf(voice.mailru_denied)),t||o){if(k.the_counter>voice.mail_counter_max)return machine_denied(g,b),k.active=!1,console.log(voice.s_err_limit),machine_done(g,b,k.the_counter),void forbidden_search(g,w);x=spot_generator(voice.appspot_arr,mailru_appspot_opened,2),empty_serp(g,b,c,x),m(v,!0)}else normal_serp(g,b,c),g==the_web?dojo.query(".result__li",e).forEach(function(e){var t=dojo.query("h3.result__title a.light-link",e)[0];if(t){var o=t.href;$(t).hasClass("never-visited")&&(o=o.replace(location.hostname,"go.mail.ru"));var n=o,i=t.innerHTML;if(n&&i){s={unescapedUrl:n,titleNoFormatting:i};var a=dojo.query("div.result__snp",e)[0];s.content=a?a.innerHTML:voice.no_content,r.responseData.results.push(s),y++}}}):"images"==g?dojo.query(".js-images-item.images-item",e).forEach(function(e){var t=dojo.query("img",e)[0],o=t.getAttribute("rel"),n=t.getAttribute("data-content");if(o&&n){var i=t.getAttribute("data-pretty"),a=t.src;(s={unescapedUrl:o,contentNoFormatting:n}).titleNoFormatting=i||n,s.tbUrl=a||o,r.responseData.results.push(s),y++}}):"video"==g&&dojo.query(".js-video-item.video-item",e).forEach(function(e){var t=dojo.query("img",e)[0],o=t.getAttribute("data-url");if(0<=o.indexOf("youtube")){var n=t.getAttribute("data-title");if(o&&n){t.getAttribute("data-pretty");(s={url:o,titleNoFormatting:n}).content=n,r.responseData.results.push(s),y++}}}),y&&f(r,w,g,search_tabs[g].had),k.shippets+=y,search_tabs[g].snippets+=y,n.request_text&&console.log(b+" - request_text = "+n.request_text),m(v+1,!1)}setTimeout(function(){if(!r){if(i&&clearInterval(i),o&&o.remove(),console.log(voice.s_err_iframe),k.the_counter>voice.mail_counter_max)return machine_denied(g,b),k.active=!1,console.log(voice.s_err_limit),machine_done(g,b,k.the_counter),void forbidden_search(g,w);x=spot_generator(voice.appspot_arr,mailru_appspot_opened,2),k.the_counter++,m(v,!0)}},3e3)});o.fail(function(e,t){ajax_fail(g,b,t,o.readyState),k.active=!1,console.log(voice.s_err_post),machine_done(g,b,k.the_counter),forbidden_search(g,w)});setTimeout(function(){k.active&&o.readyState<4&&(k.active=!1,console.log(voice.s_err_long),machine_done(g,b,k.the_counter),forbidden_search(g,w))},7e3)}(0)},engine_makers.Yandex_task_constructor=function(c,_,l){var d,p,u={};req_text=req_text.replace(reg_special,the_special),u.request_text=search_site?"site:"+search_site+" "+req_text:req_text,u.search_engine_name=l,u.search_type=c;var h=search_tabs[c].x_pane;if(c==the_web)u.search_engine_url=voice.yandex_web_engine_url;else if("images"==c)u.search_engine_url=voice.yandex_images_engine_url;else{if("video"!=c)return this.active=!1,void empty_search(c,h);u.search_engine_url=voice.yandex_video_engine_url}var m=this;m.active=!0,m.the_counter=0,m.shippets=0;document.cookie.replace(/;/gi,",").replace(reg_space,"");yandexuid_pair=get_cookie_pair("yandexuid"),yandexuid_pair=yandexuid_pair||"yandexuid=9423843411535993331",u.cookies=voice.y_cookie_start,p=spot_generator(voice.appspot_arr,yandex_appspot_opened,2),machine_start(c,l,p),function s(r){{if(!m.active)return machine_stop(c,l),void machine_done(c,l,m.the_counter);if(r>=Number(options.search_engines.Yandex)||0==d)return m.active=!1,machine_done(c,l,m.the_counter),void(0<m.shippets?fine_search(c,h):empty_search(c,h))}u.serp_number=r;var o=$.ajax({type:"POST",url:p,data:JSON.stringify(u),dataType:"json",contentType:"application/json",cache:!1,crossDomain:!0});o.done(function(e){search_tabs[c].calls++,m.the_counter++;var t=e.reply_word,o=e.serp_number;if("normal"==t){d=0;var n=e.received_cookies?e.received_cookies.toString().replace(reg_cookies,"").replace(reg_space,""):voice.y_cookie_start,i=e.response_data;if(normal_serp(c,l,o),received_arr=n.split(","),0<=n.indexOf("yandexuid")){for(var a=0;a<received_arr.length;a++)0<=received_arr[a].indexOf("yandexuid")&&(yandexuid_last=received_arr[a].replace(reg_space,""));u.cookies=voice.y_cookie_start}else u.cookies=voice.y_cookie_start;d+=_(JSON.parse(i),h,c,search_tabs[c].had),m.shippets+=d,search_tabs[c].snippets+=d,s(r+1)}else if("denied"==t){if(m.the_counter>voice.y_counter_max)return machine_denied(c,l),m.active=!1,console.log(voice.s_err_limit),machine_done(c,l,m.the_counter),void forbidden_search(c,h);p=spot_generator(voice.appspot_arr,yandex_appspot_opened,2),empty_serp(c,l,o,p),u.cookies=yandexuid_last=get_yandexuid_pair(),s(r)}else{if("empty"==t)return m.active=!1,console.log(voice.s_err_serp),machine_done(c,l,m.the_counter),void empty_search(c,h);if("error"==t)return console.log(l+the_defis+voice.server_err+e.exception),m.active=!1,console.log(voice.s_err_exception),machine_done(c,l,m.the_counter),void forbidden_search(c,h)}});o.fail(function(e,t){ajax_fail(c,l,t,o.readyState),m.active=!1,console.log(voice.s_err_post),machine_done(c,l,m.the_counter),forbidden_search(c,h)});setTimeout(function(){m.active&&o.readyState<4&&(m.active=!1,console.log(voice.s_err_long),machine_done(c,l,m.the_counter),forbidden_search(c,h))},7e3)}(0)},engine_makers.Google_task_constructor=function(s,r,c){var _=search_tabs[s].x_pane;this.active=!0;var l,d,p=this;p.shippets=0,p.the_counter=0,function t(o,n,i){if(!p.active)return void machine_done(s,c,p.the_counter);var a=$.getJSON(o+n+i).done(function(e){return search_tabs[s].calls++,p.the_counter++,l=0,"403"==(d=e.responseStatus)||"503"==d?(p.active=!1,machine_done(s,c,p.the_counter),void forbidden_search(s,_)):!e.responseData||0==e.responseData.results.length||Number(p.the_counter)>=Number(options.search_engines.Google)?n?(p.active=!1,machine_done(s,c,p.the_counter),void(0<p.shippets?fine_search(s,_):empty_search(s,_))):(p.active=!1,machine_done(s,c,p.the_counter),void empty_search(s,_)):(l+=r(e,_,s,search_tabs[s].had),p.shippets+=l,search_tabs[s].snippets+=l,void t(o,n+8,i))}).fail(function(e,t){ajax_fail(s,c,t,a.readyState),p.active=!1,machine_done(s,c,p.the_counter),forbidden_search(s,_)});setTimeout(function(){a.readyState<4&&(p.active=!1,machine_done(s,c,p.the_counter),forbidden_search(s,_))},7e3)}(voice.google_engine_url+s+"?v=1.0&key="+voice.google_key+"&hl=ru&safe=active&callback=?&rsz=8&start=",0,"&q="+(search_site?"site:"+search_site+" "+req_text:req_text))},snippets_makers.make_web_snippets=function(e,t,o,n){var a=0;for(i in e.responseData.results){var s=e.responseData.results[i],r=s.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace);s.content=s.content||r;var c=s.content.replace(reg_html,"").replace(" Скрыть",""),_=s.unescapedUrl,l=_,d=reg_host.exec(s.unescapedUrl)[2];if(-1<l.indexOf(voice.y_images_search)&&(l=voice.y_images_search),-1<l.indexOf(voice.y_video_search)&&(l=voice.y_video_search),!unic_snippet(l+r,n)){calc_aspects(r+space+c+space+d.replace(reg_the_dot,space));var p=document.createElement("div"),u=document.createElement("div"),h=voice.favicon_1+d+voice.favicon_2;u.innerHTML=h+r,$(u).addClass("my_link");var m="<div>"+c+"</div>",v='<div class="hostname">'+d+'<div class="info rel_per">'+voice.relevance+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinence+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence);$(p).html(m+v),$(p).prepend($(u)),u.setAttribute("url",_),u.setAttribute("hostname",d),u.firstChild&&u.firstChild.setAttribute&&(u.firstChild.setAttribute("url",_),u.firstChild.setAttribute("hostname",d)),dojo.connect(u,"onmouseup",null,on_search_up),$(p).addClass(o+"_snippet").addClass("my_snippet"),put_snippet(p,t),a++}}return a},snippets_makers.make_images_snippets=function(e,t,a,o){var s=0;for(i in e.responseData.results){var n=e.responseData.results[i],r=n.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace),c=n.unescapedUrl,_=n.contentNoFormatting.replace(reg_html,"");if(_=_.replace(reg_quot,reg_quot_replace),!unic_snippet(c,o)){calc_aspects(r+space+_);var l=n.tbUrl;d(t)}}function d(e){var t=new Image;t.src=l,t.alt="",t.style.cssText="margin:0;vertical-align:middle;height:"+img_size+"px;width:"+img_size+"px;border-radius:"+(img_radius-3)+"px;border:0";var o=document.createElement("a");o.href=c,o.title=_+the_dot+voice.relevan+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinen+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence),o.setAttribute("tb_url",l),$(o).colorbox({rel:"image",slideshow:!0,photo:!0,maxWidth:"95%",maxHeight:"95%"});var n=document.createElement("div");n.style.cssText="display:inline-block;border:3px solid gainsboro;margin:5px;border-radius:"+img_radius+"px;-webkit-border-radius:"+img_radius+"px;-moz-border-radius:"+img_radius+"px;box-shadow:4px 5px 3px gray;border-style:inset",o.appendChild(t),n.appendChild(o),$(n).addClass(a+"_snippet").css("margin","3px"),put_snippet(n,e),s++,$(e).abs_animate({properties:{height:1.1,width:1.1}},t)}return s},snippets_makers.make_video_snippets=function(e,t,a,o){var s=0;for(i in e.responseData.results){var n=e.responseData.results[i],r=n.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace),c=n.url,_=n.content.replace(reg_html,"");if(!unic_snippet(c,o)){calc_aspects(r+space+_);var l=c.indexOf("="),d=c.substring(l+1,l+12);p(t)}}function p(e){var t=new Image;t.src="http://i.ytimg.com/vi/"+d+"/mqdefault.jpg",t.alt="",t.style.cssText="margin:0;vertical-align:middle;height:"+vid_size+"px;width:"+vid_size+"px;border-radius:"+(vid_radius-3)+"px;border:0";var o=document.createElement("a");o.href="http://www.youtube.com/embed/"+d+"?rel=1&amp;wmode=transparent",o.title=r+the_dot+voice.relevan+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinen+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence),o.title=o.title.replace(reg_quot,reg_quot_replace),$(o).colorbox({rel:"video",iframe:!0,innerWidth:720,innerHeight:480,maxWidth:"95%",maxHeight:"95%"});var n=document.createElement("div");n.style.cssText="display:inline-block;border:3px solid gainsboro;margin:5px;border-radius:"+vid_radius+"px;-webkit-border-radius:"+vid_radius+"px;-moz-border-radius:"+vid_radius+"px;box-shadow:4px 5px 3px gray;border-style:inset",o.appendChild(t),n.appendChild(o),$(n).addClass(a+"_snippet").css("margin","3px"),put_snippet(n,e),s++,$(e).abs_animate({properties:{height:1.1,width:1.1}},t)}return s},snippets_makers.make_blogs_snippets=function(e,t,o,n){var a=0;for(i in e.responseData.results){var s=e.responseData.results[i],r=reg_host.exec(s.postUrl)[2],c=s.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace),_=s.postUrl,l=s.content.replace(reg_html,"");if(!unic_snippet(_+c,n)){calc_aspects(c+space+l);var d=document.createElement("div"),p=document.createElement("div"),u=voice.favicon_1+r+voice.favicon_2;p.innerHTML=u+c,$(p).addClass("my_link");var h="<div>"+s.content+"</div>";s.author=s.author||voice.unknown;var m=s.publishedDate?s.publishedDate.substring(0,s.publishedDate.indexOf("-")-1):voice.unknown;h+='<div class="info">Автор: '+s.author+".&nbsp;&nbsp;Дата публикации: "+m+"</div>";var v='<div class="hostname">'+r+'<div class="info rel_per">'+voice.relevance+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinence+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence)+"</div></div>";$(d).html(h+v),$(d).prepend($(p)),p.setAttribute("url",_),p.setAttribute("hostname",r),p.firstChild&&p.firstChild.setAttribute&&(p.firstChild.setAttribute("url",_),p.firstChild.setAttribute("hostname",r)),dojo.connect(p,"onmouseup",null,on_search_up),$(d).addClass("my_snippet").addClass(o+"_snippet"),put_snippet(d,t),a++}}return 0<a&&$("div.search_empty",t).removeClass("search_empty"),a},snippets_makers.make_news_snippets=function(e,t,o,n){var a=0;for(i in e.responseData.results){var s=e.responseData.results[i],r=reg_host.exec(s.unescapedUrl)[2],c=s.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace),_=s.unescapedUrl,l=s.content.replace(reg_html,"");if(!unic_snippet(_+c,n)){calc_aspects(c+space+l);var d=document.createElement("div"),p=document.createElement("div"),u=voice.favicon_1+r+voice.favicon_2;p.innerHTML=u+c,$(p).addClass("my_link");var h="<div>"+s.content+"</div>";h+='<div class="info">Источник: '+s.publisher+".&nbsp;&nbsp;Дата публикации: "+s.publishedDate.substring(0,s.publishedDate.indexOf("-")-1)+"</div>";var m='<div class="hostname">'+r+'<div class="info rel_per">'+voice.relevance+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinence+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence)+"</div></div>";$(d).html(h+m),$(d).prepend($(p)),p.setAttribute("url",_),p.setAttribute("hostname",r),p.firstChild&&p.firstChild.setAttribute&&(p.firstChild.setAttribute("url",_),p.firstChild.setAttribute("hostname",r)),dojo.connect(p,"onmouseup",null,on_search_up),$(d).addClass("my_snippet").addClass(o+"_snippet"),put_snippet(d,t),a++}}return a},snippets_makers.make_books_snippets=function(e,t,o,n){var a=0;for(i in e.responseData.results){var s=e.responseData.results[i],r=reg_host.exec(s.unescapedUrl)[2],c=s.titleNoFormatting.replace(reg_html,"").replace(reg_quot,reg_quot_replace),_=s.unescapedUrl,l=s.tbUrl,d=s.authors;if(!unic_snippet(r+c,n)){calc_aspects(c+space+d);var p=new Image;p.src=l,p.alt="",p.style.cssText="float:left;height:"+s.tbHeight+"px;width:"+s.tbWidth+"px;border:0;margin-right:5px;margin-bottom:5px;",$x_div=$("<div/>").css({clear:"left","min-height":"80px"});var u=$x_div.get(0),h=document.createElement("div");h.innerHTML=c,$(h).addClass("my_link");var m="<div>Авторы:&nbsp;"+d+"</div>";m+='<div class="info">Книжный номер:&nbsp;'+s.bookId+".&nbsp;Год издания:&nbsp;"+s.publishedYear+".&nbsp;Страниц:&nbsp;"+(0!=s.pageCount?s.pageCount:voice.unknown)+".</div>";var v='<div class="hostname">'+r+'<div class="info rel_per">'+voice.relevance+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinence+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence)+"</div></div>";$x_div.html(m+v),$x_div.prepend($(h)),$x_div.prepend($(p)),h.setAttribute("url",_),h.setAttribute("hostname",r),h.firstChild&&h.firstChild.setAttribute&&(h.firstChild.setAttribute("url",_),h.firstChild.setAttribute("hostname",r)),dojo.connect(h,"onmouseup",null,on_search_up),$x_div.addClass("my_snippet").addClass(o+"_snippet"),put_snippet(u,t),a++}}return a},snippets_makers.make_patent_snippets=function(e,t,o,n){var a=0;for(i in e.responseData.results){var s=e.responseData.results[i],r=reg_host.exec(s.unescapedUrl)[2],c=s.title.replace(reg_html,"").replace(reg_quot,reg_quot_replace),_=s.unescapedUrl,l=s.content,d=s.patentNumber;if(!unic_snippet(d+c,n)&&(calc_aspects(c+space+l),!(_.indexOf(d)<0))){var p=$("<div/>").addClass("my_snippet"),u=p.get(0),h=$("<div/>").addClass("my_link");h.attr("url",_).attr("hostname",r);var m=h.children[0];m&&m.attr("url",_).attr("hostname",r),h.bind("mouseup",on_search_up);var v=voice.favicon_1+r+voice.favicon_2;h.html(v+c);var g="<div>"+l+"</div>";g+='<div class="info">Номер патента:&nbsp;'+s.patentNumber+".&nbsp;Статус патента:&nbsp;"+s.patentStatus+".</div>";var f='<div class="hostname">'+r+'<div class="info rel_per">'+voice.relevance+("r_m"==sort_attr?aspects.relevance_meta:aspects.relevance)+voice.pertinence+("p_m"==sort_attr?aspects.pertinence_meta:aspects.pertinence)+"</div></div>";p.html(g+f),p.prepend(h).addClass(o+"_snippet"),put_snippet(u,t),a++}}return a},snippets_makers.make_local_snippets=function(e,t,o,n){},panes_stack=function(e,t){alert_hide();var o=panes[0];if(arguments.length){for(n=0;n<panes.length;n++)if((o=panes[n]).id==e){t&&(o.tab=t.substr(2));break}}else if(-1<search_divs.indexOf(o.id)){choice_menu_make(voice.choice_tuning,voice.choice_context,show_context_search);for(var n=0;n<panes.length&&"semantic"!=(o=panes[n]).id;n++);}else o=panes[1];view_pane(o),"global"==o.id&&(search_tabs[o.tab].coming_search?coming_search.style.zIndex=1:coming_search.style.zIndex=-1),o.z=++max_z,panes.sort(pane_comparator)},make_semantic=function(e){if(dojo.byId("preloader_start").style.display="none",e.indexOf("lodlive")<0&&lodlive_scroll_save(),-1<e.indexOf("lodlive"))if(lodlive_was){var t=dojo.query("#lodlive > iframe")[0];t.style.width="99%",setTimeout(function(){if(t.style.width="100%",ff){var e=t.contentDocument||t.contentWindow.document;dojo.query(".boxTitle",e)[0].scrollIntoView(),t.contentWindow.scrollBy(200,-100)}},9)}else lodlive_load();else if(-1<e.indexOf("dbpedia"))dbpedia_was?dbpedia_semantic||get_img($img_x,image_animator_x,400,e):dbpedia_start(e);else if(-1<e.indexOf("wdqs"))if(wdqs_was)if(wdqs_semantic){var o=dojo.query("#wdqs > iframe")[0];o.style.width="99%",setTimeout(function(){o.style.width="100%"},9)}else get_img($img_wdqs,image_animator_wdqs,400,e);else wdqs_start(e);else-1<e.indexOf("annotation")?annotation_was?annotation_semantic?$("#annotation_queryText")[0].focus():get_img($img_y,image_animator_y,400,e):annotation_start(e):-1<e.indexOf(the_grab)&&get_img($img_z,image_animator_z,400,e);panes_stack("semantic",e)},require(["dojo/_base/fx","dijit/Dialog","dojo/domReady!","dojo/data/ItemFileWriteStore"],function(t,o){dojo.ready(function(){if(anim=t.animateProperty,dummy=dojo.byId("dummy"),form=dojo.byId("_footer_callback"),navigation=dojo.byId("_footer_navigation"),ajax_start(stock_holder+"form_navigation.html"),ajax_start(stock_holder+"tree_voice.json"),ajax_start(stock_holder+"context_dialogs.html"),dojo.query("#make_fine .centerPanel.cloud > div").forEach(function(e){var t=e.id.substr(2);trees[t]={},trees[t].fetch=!1,trees[t].treeStore=new dojo.data.ItemFileWriteStore({url:cloud_holder+t+".json"}),trees[t].treeStore.fetch({query:{name:"$"},queryOptions:{deep:!1},onComplete:function(){}})}),dojo_dialog_constructor=o,test_browser()){make_fine=dojo.byId("make_fine"),frame=dojo.byId("frame"),invisible_div=dojo.byId("invisible_div"),close_btn=dojo.byId("close_btn"),header_wrap=dojo.byId("header_wrap"),wel_com=dojo.byId("welcom");var e=setInterval(function(){form_ok&&voice_ok&&context_dialog_ok&&(clearInterval(e),$.getScript(software_holder+"script/add_engine.js",start))},10)}})});var semantic_pane_manipulator=function(n){var e=the_s+n,t=$(the_sharp+e);t.css("overflow","visible");function i(){$(".skrepka_float",t).unbind("mouseup").bind("mouseup",v),$(".skrepka_fixed",t).unbind("mouseup").bind("mouseup",g)}function a(){"visible"==h.css("visibility")?(o&&clearInterval(o),l.css({height:_.outerHeight(!0)-d.outerHeight(!0)+"px"})):(o&&clearInterval(o),o=setInterval(function(){l.css({height:d.outerHeight(!0)+p.outerHeight(!0)+"px"})},200)),panes_stack("semantic",e)}var s,o,r,c="#"+n,_=t,l=$(c,t),d=$(c+"_invite",t),p=$(c+"_result",t),u=$(".skrepka_float",t),h=$(".skrepka_fixed",t),m=$(".jspPane",_),v=function(){r=c,s=_.children(),_.empty(),l.empty(),_.append(d).append(u).append(h).append(l),very_scroll(r);var e=$(".jspContainer",l),t=$(".jspPane",l),o=_.outerHeight()-d.outerHeight()+"px";e.css({position:"absolute",bottom:"0px",left:"0px",right:"0px",overflow:"hidden",height:o}),selector_alive(n,d),t.append(p).append("<br>"),i(),u.css({visibility:"hidden",zIndex:"-5"}),h.css({visibility:"visible",zIndex:"5"}),a()},g=function(){r=e,_.empty(),l.empty(),_.append(s);$(".jspContainer",_);l.append(d).append(p).append(u).append(h).append("<br>"),m.append(l),selector_alive(n,d),i(),u.css({visibility:"visible",zIndex:"5"}),h.css({visibility:"hidden",zIndex:"-5"}),a()};i(),dojo.connect(window,"onresize",null,function(){if("visible"==h.css("visibility")){r=c;var e=_.outerHeight(!0)-d.outerHeight(!0)+"px";l.css({height:e})}})};function selector_alive(e,t){var o=$("select",t);"dbpedia"==e?o.unbind("mouseup").bind("mouseup",function(){writer(o.val())}):"annotation"==e?($anSelect.unbind("mouseup").bind("mouseup",doAnSelect),$anStartBtn.unbind("mouseup").bind("mouseup",doAnStartBtn),$anStopBtn.unbind("mouseup").bind("mouseup",doAnStopBtn)):console.log("err!")}function lodlive_load(){}function wdqs_iframe_load(){}function dbpedia_load(){}function agentIsOK(e,t){setTimeout(function(){null==e||void 0===e||void 0===e.closed?browserMessage(voice.mes_agent):(e.blur(),e&&t&&win_opened.push({win:e,name:t}))},1500)}function childIsOK(e){setTimeout(function(){null==child||void 0===child||void 0===child.closed?browserMessage(voice.mes1+voice.mes2):child.focus()},800),e&&win_opened.push({win:child,name:e})}}();