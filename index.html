<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Веб-гид по кулинарным рецептам">
    <title>Веб-гид по кулинарным рецептам</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="css/light_div_css/light_div.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="css/style.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/dojo.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="script/light_div_blue_max.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
<div id="flickr_container"></div>
<div id="youtube_container"></div>
<script type="text/javascript">
		$('#flickr_container').light_flickr('150', 'rect', 'right', 'MEPhI');
        $('#youtube_container').light_youtube('155', 'circle', 'left', "ts-NEitEZp4", "AA_po_K10Zo", "5k4ePNW2qBo", "MIuXxozpbAU", 
		"QVfZxN_CNR0", "vUBkcQOv2P8", "_-9nH4zFThs");
</script>
    <table id="recipes"></table>
    <script>
        var recipesTable = document.getElementById('recipes'),
            requestURL = 'https://raw.githubusercontent.com/comp-vis-proj/recipes/master/recipes.json',
            request = new XMLHttpRequest();
        request.open('GET', requestURL);
        request.onload = function(e) {
            if (request.readyState === 4) {
                if (request.status === 200) {
                    console.log(request.response);
                    var dataTable = JSON.parse(request.responseText);
                    getTableInfo(dataTable);
                } else {
                    console.error(request.statusText);
                }
            }
        };
        request.onerror = function(e) {
            console.error(request.statusText);
        };
        request.send();

        function getTableInfo(data) {
            let headerTr = document.createElement('tr');
            headerTr.innerHTML = '<th>Название</th><th>Время (мин.)</th><th>Кухня</th><th style="width:20%">Ингредиенты</th><th>Этапы приготовления</th><th>Фото</th>';
            recipesTable.appendChild(headerTr);
            data.recipes.forEach(function(elem) {
			ing_s = st_s = "";	
				for (let ing in elem.ingredients)
					ing_s += elem.ingredients[ing] + "<br/>";
				for (let st in elem.stages)
					st_s += elem.stages[st] + "<br/>";
				let tr = document.createElement('tr');
                tr.innerHTML = `<td>${elem.name}</td><td>${elem.time}</td><td>${elem.cuisine}</td>
				<td>${ing_s}</td><td>${st_s}</td>
				<td><img src="${elem.photo}" width="289" height="180"></td>`;
                recipes.appendChild(tr);
            });
        }
    </script>
</body>

</html>